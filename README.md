# Телеграм-бот для парсинга цен

Телеграм-бот для сбора данных с сайтов и расчета средних цен на товары (в текущей конфигурации настроен для Samsung Galaxy S23).

## Возможности

- Загрузка Excel-файлов с данными для парсинга сайтов
- Хранение информации о сайтах в базе данных SQLite
- Расчет средних цен с настроенных сайтов
- Удобный интерфейс с кастомными кнопками

## Требования

- Python 3.8+
- Токен Telegram бота (получить у [@BotFather](https://t.me/BotFather))

## Установка

1. Клонируйте репозиторий
2. Установите необходимые пакеты:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` в корне проекта и добавьте токен вашего Telegram бота:
```
TELEGRAM_BOT_TOKEN=ваш_токен
```

## Использование

1. Запустите бота:
```bash
python main.py
```

2. В Telegram отправьте команду `/start`

3. Загрузите Excel-файл, используя кнопку "Загрузить файл". Excel-файл должен содержать следующие столбцы:
   - `title`: Название сайта/магазина
   - `url`: URL страницы товара
   - `xpath`: XPath для элемента с ценой

4. Используйте команду `/average` для получения средних цен со всех настроенных сайтов

## Структура базы данных

Бот использует базу данных SQLite (`sites.db`) со следующей схемой:

```sql
CREATE TABLE sites (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    url TEXT NOT NULL,
    xpath TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

## Структура проекта

```
├── main.py           # Основная логика бота
├── requirements.txt  # Зависимости Python
├── .env             # Переменные окружения
├── sites.db         # База данных SQLite
└── uploads/         # Временное хранилище для загруженных файлов
```

## Зависимости

- pyTelegramBotAPI
- pandas
- python-dotenv
- openpyxl
- SQLAlchemy

## Обработка ошибок

Бот включает обработку следующих ошибок:
- Некорректные загрузки файлов
- Отсутствующие столбцы в Excel
- Операции с базой данных
- Операции парсинга цен

## Формат Excel-файла

Excel-файл должен содержать следующие обязательные столбцы:
- `title`: Название магазина или сайта
- `url`: Полный URL страницы с товаром
- `xpath`: Путь XPath к элементу, содержащему цену

Пример содержимого файла:
| title | url | xpath |
|-------|-----|-------|
| DNS | https://www.dns-shop.ru/product/... | //div[@class='price']/span |
| МВидео | https://www.mvideo.ru/products/... | //div[@class='price-block']/span |